{% load static %}

<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="COVID19 Detection using X-Ray Images">
		<meta name="author" content="Ayush Kumar">
		<title>COVID-19 Detector | CoviScan</title>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
		<link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Poiret+One&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="{% static 'styles.css' %}">
		<link rel="shortcut icon" type="image/png" href="{% static 'logo_light_new.png' %}"/>
	</head>
	
	<body>
		<div>
			<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
				<a class="navbar-brand" href={% url 'index' %} style="font-weight: 500; font-family: 'Poiret One'; font-size: 1.5rem; color: #eef8f7">
				<img src="{% static 'logo_light_new.png' %}" alt="" width="30" height="30">
				coviscan
				</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbarNav">
					<ul class="navbar-nav">
						<li class="nav-item">
							<a class="nav-link active" href={% url 'index' %}>Home <span class="sr-only">(current)</span></a>
						</li>
                        <li class="nav-item">
							<a class="nav-link" href={% url 'api_docs' %}>API <span class="sr-only">(current)</span></a>
						</li>
					</ul>
				</div>
			</nav>
		</div>
		
		<div class="container-fluid">
			<br> <br>
			<div class="container box">
				<div class="card border-light" style="border-color: rgba(217,218,219,.5)!important;">
					<h5 class="card-header bg-light">COVID-19 Detection Using X-Rays</h5>
					<div class="card-body form-div">
						<form method="POST" action="{% url 'index_predict' %}" enctype="multipart/form-data">
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">Patient Name</span>
                                </div>
                                <input type="text" name="name" id="input_name" class="form-control" aria-describedby="basic-addon1">
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="inputGroupFileAddon01">X-Ray Image</span>
                                </div>
                                <div class="custom-file">
                                    <input type="file" name="image" id="input_image" class="custom-file-input" id="inputGroupFile01" aria-describedby="inputGroupFileAddon01" required>
                                    <label class="custom-file-label" for="inputGroupFile01">Choose file</label>
                                </div>
                            </div>
							<div class="form-group text-center">
								<br>
								<button type="submit" id="orig_submit_btn" style="display: none;" class="btn btn-primary">Predict</button>
								<button class="btn btn-rounded btn-dark" id="form-button">
									<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" id="spinr"></span>
									Upload and Predict
								</button>
							</div>
						</form>
					</div>	
				</div>	
			</div>
			<div id="result-div">
			</div>
		</div>


		<!-- ################################## -->


		<div class="container">
			<div class="container prediction-div">
				<div class="col-5">
					<img src="{% static 'xray_sample.jpg' %}" id="x-ray_img" class="rounded-lg mx-auto my-auto d-block ig" alt="X-Ray Image">
				</div>
				<div class="col-7">
					<div class="row-special">
						<div class="card card-special">
							<div class="svg-div">
								<svg viewBox="0 0 36 36" class="circular-chart orange">
									<path class="circle-bg"
									  d="M18 2.0845
										a 15.9155 15.9155 0 0 1 0 31.831
										a 15.9155 15.9155 0 0 1 0 -31.831"
									/>
									<path class="circle"
									  stroke-dasharray="30, 100"
									  d="M18 2.0845
										a 15.9155 15.9155 0 0 1 0 31.831
										a 15.9155 15.9155 0 0 1 0 -31.831"
									/>
									<text x="18" y="20.55" class="percentage" id="covid_p_h">30%</text>
								</svg>
							</div>
							<div class="card-body prediction-text">
								<div>
									<h5 class="card-title">COVID-19</h5>
									<p class="card-text">Probability: <span id="covid_p_f">30.0213%</span></p>
								</div>
							</div>
						</div>
	
						<div class="card card-special">
							<div class="svg-div">
								<svg viewBox="0 0 36 36" class="circular-chart green">
									<path class="circle-bg"
										d="M18 2.0845
										a 15.9155 15.9155 0 0 1 0 31.831
										a 15.9155 15.9155 0 0 1 0 -31.831"
									/>
									<path class="circle"
										stroke-dasharray="60, 100"
										d="M18 2.0845
										a 15.9155 15.9155 0 0 1 0 31.831
										a 15.9155 15.9155 0 0 1 0 -31.831"
									/>
									<text x="18" y="20.55" class="percentage" id="pneumonia_p_h">60%</text>
								</svg>
							</div>
							<div class="card-body prediction-text">
								<div>
									<h5 class="card-title">Pneumonia</h5>
									<p class="card-text">Probability: <span id="pneumonia_p_f">59.9961%</span></p>
								</div>
							</div>
						</div>
	
						<div class="card card-special">
							<div class="svg-div">
								<svg viewBox="0 0 36 36" class="circular-chart blue">
									<path class="circle-bg"
										d="M18 2.0845
										a 15.9155 15.9155 0 0 1 0 31.831
										a 15.9155 15.9155 0 0 1 0 -31.831"
									/>
									<path class="circle"
										stroke-dasharray="90, 100"
										d="M18 2.0845
										a 15.9155 15.9155 0 0 1 0 31.831
										a 15.9155 15.9155 0 0 1 0 -31.831"
									/>
									<text x="18" y="20.55" class="percentage" id="normal_p_h">90%</text>
								</svg>
							</div>
							<div class="card-body prediction-text">
								<div class>
									<h5 class="card-title">Normal</h5>
									<p class="card-text">Probability: <span id="normal_p_f">90.0083%</span></p>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		

		<!-- ################################## -->

		
        <div class="footer">
			<div>Designed by Ayush Kumar</div>
			<div id="links">
				<div>
					<a href="https://github.com/ayush9304" target="_blank" id="github">
						<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-github" viewBox="0 0 16 16">
							<path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
						</svg>
					</a>
				</div>
				<div>
					<a href="https://www.linkedin.com/in/ayushkumar930" target="_blank" id="linkedin">
						<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-linkedin" viewBox="0 0 16 16">
							<path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"/>
						</svg>
					</a>
				</div>
			</div>
    	</div>

	<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

		<script>
			var dt = new Date();
			document.querySelector("#form-button").addEventListener('click', handleForm);
			function handleForm(event) {
				event.preventDefault();
				document.querySelector("#form-button").disabled = true;
				document.querySelector("#spinr").style.display = "inline-block";
				let image = document.querySelector("#input_image");
				if(image.files.length <= 0){
					document.querySelector("#orig_submit_btn").click();
					document.querySelector("#form-button").disabled = false;
					document.querySelector("#spinr").style.display = "none";
					return;
				}
				let name = document.querySelector("#input_name").value;
				if(name.length == 0){
					name = "Anonymous";
				}
				let formData = new FormData();
				formData.append('name',name);
				formData.append('image',image.files[0]);
				fetch('/predict', {
					method:'POST',
					body: formData
				})
				.then(response => response.json())
				.then(response => {
					if(response.success){
						document.querySelector("#result-div").innerHTML = `
							<div aria-live="polite" aria-atomic="true" class="d-flex justify-content-center align-items-center prediction-box" style="min-height: 200px;">
								<div role="alert" aria-live="assertive" aria-atomic="true" class="toast" data-autohide="false">
								<div class="toast-header">
									<strong class="mr-auto">Prediction &emsp; &emsp; &emsp; &emsp; &emsp;</strong>
									<small><span id="datetime">${dt.toLocaleTimeString()}</span></small>
									<button type="button" class="ml-2 mb-1 close toast-close-button" onclick="close_toast()" data-dismiss="toast" aria-label="Close">
									<span aria-hidden="true">&times;</span>
									</button>
								</div>
								<div class="toast-body">
									<h6>success: ${response.success}</h6>
									<h6>method: ${response.method}</h6>
									<h6>name: ${response.name}</h6>
									<h6>description: ${response.description}</h6>
									<h6>covid_percentage: ${response.covid_percentage}</h6>
									<h6>normal_percentage: ${response.normal_percentage}</h6>
									<h6>pneumonia_percentage: ${response.pneumonia_percentage}</h6>
									<h6>prediction: ${response.prediction}</h6>
									<h6>image_url: ${response.image_url}</h6>
								</div>
								</div>
							</div>
						`;
					}
					else{
						document.querySelector("#result-div").innerHTML = `
						<div aria-live="polite" aria-atomic="true" class="d-flex justify-content-center align-items-center prediction-box" style="min-height: 200px;">
								<div role="alert" aria-live="assertive" aria-atomic="true" class="toast" data-autohide="false">
								<div class="toast-header">
									<strong class="mr-auto">Prediction &emsp; &emsp; &emsp; &emsp; &emsp;</strong>
									<small><span id="datetime">${dt.toLocaleTimeString()}</span></small>
									<button type="button" class="ml-2 mb-1 close toast-close-button" onclick="close_toast()" data-dismiss="toast" aria-label="Close">
									<span aria-hidden="true">&times;</span>
									</button>
								</div>
								<div class="toast-body">
									<h6>success: ${response.success}</h6>
									<h6>method: ${response.method}</h6>
									<h6>description: ${response.description}</h6>
								</div>
								</div>
							</div>
						`;
					}
				})
				.then(() => {
					document.querySelector("#form-button").disabled = false;
					document.querySelector("#spinr").style.display = "none";
				});
				
			}
			function close_toast(){
				document.querySelector(".toast").style.display = "none";
			}
		</script>
	</body>
</html>
